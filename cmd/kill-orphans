#!/bin/bash
export INFO='kill all unattatched (orphaned) tmux sessions'

# Get the list of all tmux sessions
sessions=$(tmux list-sessions -F '#{session_name} #{session_attached}')

count=0

# Iterate through each session
while read -r session_info; do
  # Split the session_info into session_name and session_attached
  IFS=' ' read -r -a info_array <<< "$session_info"
  session_name="${info_array[0]}"
  session_attached="${info_array[1]}"

  # Check if the session is not attached
  if [ "$session_attached" -eq "0" ]; then
    # Kill the unattached session
    tmux kill-session -t "$session_name"
    count=$((count + 1))
  fi
done <<< "$sessions"

if [ "$count" -gt 0 ]; then
    [ "$count" = 1 ] || s='s'
    notify-send "Killed $count orphan$s."
    exit 0
else
    notify-send "No orphans to kill."
    exit 1
fi
