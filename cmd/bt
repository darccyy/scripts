#!/bin/sh
#~~~ connect or disconnect a particular bluetooth device

mac='40:DE:17:43:2F:49'

# Start scanning for all devices, until given MAC address is found
scan_and_wait() {
    bluetoothctl scan on &
    while ! bluetoothctl devices | grep -q "$mac"; do
        sleep 1
    done
    bluetoothctl scan off
}

# Run subcommand
case "$1" in
    connect)
        bluetoothctl power on
        scan_and_wait
        bluetoothctl connect $mac
        ;;

    disconnect)
        bluetoothctl disconnect $mac
        bluetoothctl power off
        ;;

    mac)
        echo $mac
        ;;

    status)
        if [ "$2" = 'icon' ]; then
            bluetoothctl devices | grep -q "$mac" && echo '' || echo ''
        else
            bluetoothctl devices | grep -q "$mac" && echo '1' || echo '0'
        fi
        ;;

    *)
        echo "Please provide subcommand: [ connect | disconnect | mac | status ]"
        ;;
esac

